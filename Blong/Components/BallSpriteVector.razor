@using System.ComponentModel
@using System.Numerics
@inject GameManager gameManager
<style>

    .ball {
        top: @(Sprite.Box.Top)px;
        left: @(Sprite.Box.Left)px;
        height: @(Sprite.Box.Width)px;
        width: @(Sprite.Box.Width)px;
        background-color: whitesmoke;
        position: absolute;
    }

 </style>

<div class="ball" />

@code {

    [Parameter]
    public Sprite Sprite { get ; set ; }


    // get ot know your component lifecycle : 
    // https://docs.microsoft.com/en-us/aspnet/core/blazor/lifecycle?view=aspnetcore-3.1
    //

    protected override void OnParametersSet()
    {

        // init the timer update event
        Sprite.Render = (timeState) =>
        {
            var sprite = (Sprite) timeState;
            sprite.MoveBox();

            InvokeAsync(() => // threading dispatch wrapper
            {
                StateHasChanged();
            });
        };

        #region Physics & Math

        Sprite.Collide = (target) =>
        {
            Vector2 vectorResult = new Vector2(Sprite.Box.Top, Sprite.Box.Left);
            
            var vx = Sprite.Vx;
            var vy = Sprite.Vy;


            if (Sprite.Box.Left < target.Box.Right)  // overlap left
            {
                vy = -Sprite.Vy;
            }


            var angle = Math.Atan2(vy, vx);
            Sprite.Direction = Sprite.ConvertToDegrees(angle);

        };

        Sprite.OutOfBounds = (bounds) =>
        {
            var vx = Sprite.Vx;
            var vy = Sprite.Vy;

            if (Sprite.Box.Left < bounds.Left ||
                Sprite.Box.Right > bounds.Right)
            {
                vy = -Sprite.Vy;
            }

            if (Sprite.Box.Top < bounds.Top ||
                Sprite.Box.Bottom > bounds.Bottom)
            {
                vx = -Sprite.Vx;
            }

            var angle = Math.Atan2(vy, vx);
            Sprite.Direction = Sprite.ConvertToDegrees(angle);

            //if (Sprite.Box.Top < bounds.Top) Sprite.Box.Top = bounds.Top;
            //if (Sprite.Box.Bottom > bounds.Bottom) Sprite.Box.Top = bounds.Bottom-Sprite.Box.Height;
            //if (Sprite.Box.Left < bounds.Left) Sprite.Box.Left = bounds.Left;
            //if (Sprite.Box.Right > bounds.Right) Sprite.Box.Left = bounds.Bottom-Sprite.Box.Width;

        };

        #endregion


    }
}
